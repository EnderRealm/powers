---
id: p-022f
status: open
deps: [p-88d1, p-438d]
links: []
created: 2026-02-08T20:05:59Z
type: task
priority: 2
assignee: Steve Macbeth
parent: p-2f2f
---
# Write extract-session-summary.sh and register SessionEnd hook

Write the extraction script that pulls summaries from session JSONL and pushes to learnings repo. Register as SessionEnd command hook.

## Design

Files: hooks/extract-session-summary.sh (new), hooks/hooks.json (modify)
Script receives JSON on stdin: session_id, transcript_path, cwd, reason.
Steps:
  1. Parse stdin JSON with jq
  2. Read transcript_path JSONL
  3. Search for BEGIN_SESSION_SUMMARY / END_SESSION_SUMMARY sentinel markers in assistant messages
  4. If not found, exit 0 silently (catch-up will handle)
  5. Extract content between markers
  6. Parse ticket IDs from body
  7. Infer project from basename of cwd
  8. Build YAML frontmatter: project, session_id, date, branch (from git), tickets, processed: false
  9. Write to LEARNINGS_REPO/sessions/<project>/<date>-<session_id>.md
  10. git add, commit, push (rebase on conflict, max 3 retries)
LEARNINGS_REPO defaults to ~/code/learnings, configurable via env var.
Register SessionEnd hook in hooks.json with type: command, timeout: 30.
See docs/LEARNING-EXTRACTION-DESIGN.md Summary Extraction Rules section.

## Acceptance Criteria

Script extracts summary from JSONL using sentinels, writes valid frontmatter+body to learnings repo, pushes via git. SessionEnd hook registered in hooks.json.

